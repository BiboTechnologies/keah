<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8">
  <title>Bibo Medical Systems </title>
  <link href="BMS.png" rel="icon">
   <!-- Include the jQuery library -->
   <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
   <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
   <!-- Include the Select2 CSS and JS files -->
   <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
   <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
   <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css'>
<link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/gentelella/1.3.0/css/custom.css'>
<link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css'><link rel="stylesheet" href="./portal.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.0.2/js/bootstrap.bundle.min.js"></script>
</head>

<!-- partial:index.partial.html -->
<body class="nav-md">
<!-- Splash screen content -->
  <div id="splashScreen">
    <div id="logo"></div>
    <div id="loadingText"></div>
  </div>
<div class="container body">
  <div class="main_container">
    <div class="col-md-3 left_col">
      <div class="left_col scroll-view">
        <div class="navbar nav_title" style="border: 0;">
          <a href="index.html" class="site_title">
            <img class="dashImg" src="BMS logo only.png" alt="Dashboard Image">
            <span>BIBO MEDSYS</span>
        </a>
              </div>

        <div class="clearfix"></div>

        <!-- menu profile quick info -->
        <div class="profile clearfix">
          <div class="profile_pic">
            <img src="" alt="..." class="img-circle profile_img">
          </div>
          <div class="profile_info">
            
  <span>Welcome,</span>
  <h2 id="profileName"></h2>
          </div>
        </div>
        <!-- /menu profile quick info -->

        <br />

        <!-- sidebar menu -->
        <div id="sidebar-menu" class="main_menu_side hidden-print main_menu">
          <div class="menu_section">
            <h3>General</h3>
            <ul class="nav side-menu">
              <li><a><i class="fa fa-home"></i> Home <span class="fa fa-chevron-down"></span></a>
                <ul class="nav child_menu">
                  <li><a href="index.html">Dashboard Management</a></li>
                <li><a href="cashier.html">Cashier Desk</a></li>
              <!--     <li><a href="index3.html">Dashboard3</a></li>--> 
                </ul>
              </li>
              <li><a><i class="fa fa-edit"></i>Treatment<span class="fa fa-chevron-down"></span></a>
                <ul class="nav child_menu">
                  <li><a href="laboratory.html">Laboratory</a></li>
                  <li><a href="patients.html">Patients Reception</a></li>
                  <li><a href="odp.html">Patient's on Treatment</a></li>
                 <li><a href="doctors.html">Doctor's Room</a></li>
                 <li><a href="dental.html">Dental Department</a></li>
                 <li><a href="scan.html">Scan Department</a></li>
                 <li><a href="babies.html">Babies Department</a></li>


                </ul>
              </li>
              <li><a><i class="fa fa-medkit"></i>Medicine<span class="fa fa-chevron-down"></span></a>
                <ul class="nav child_menu">
                 <li><a href="medicines.html">Medicine Store</a></li>
                <!--   <li><a href="media_gallery.html">Media Gallery</a></li>
                  <li><a href="typography.html">Typography</a></li>
                  <li><a href="icons.html">Icons</a></li>
                  <li><a href="glyphicons.html">Glyphicons</a></li>
                  <li><a href="widgets.html">Widgets</a></li>
                  <li><a href="invoice.html">Invoice</a></li>
                  <li><a href="inbox.html">Inbox</a></li>
                  <li><a href="calendar.html">Calendar</a></li>
                </ul>
              </li>
              <li><a><i class="fa fa-table"></i> Tables <span class="fa fa-chevron-down"></span></a>
                <ul class="nav child_menu">
                  <li><a href="tables.html">Tables</a></li>
                  <li><a href="tables_dynamic.html">Table Dynamic</a></li>-->
                </ul>
              </li>
              <li><a><i class="fa fa-bar-chart-o"></i> Data Analytics <span class="fa fa-chevron-down"></span></a>
                <ul class="nav child_menu">
                  <li><a href="sales.html">Data Entry</a></li>
               <!--    <li><a href="revenue.html"> Data Entry Analytics</a></li>
              <li><a href="tests.html">Tests</a></li>
                    <li><a href="echarts.html">ECharts</a></li>
                  <li><a href="other_charts.html">Other Charts</a></li>-->
                </ul>
              </li>
            <li><a><i class="fa fa-clone"></i>Management<span class="fa fa-chevron-down"></span></a>
                <ul class="nav child_menu">
                  <li><a href="staff.html">Hospital Staff</a></li>
               <li><a href="insurance.html">Insurance </a></li>              
              
              
                </ul>
              </li>
            </ul>
          </div>
       <div class="menu_section">
            <ul class="nav side-menu">
              <li><a><i class="fa fa-bug"></i>Tests & Prescription<span class="fa fa-chevron-down"></span></a>
               <ul class="nav child_menu">
                  <li><a href="clinical.html">Clinical Tests  & Prescriptions</a></li>
               <!--   <li><a href="projects.html">Projects</a></li>
                  <li><a href="project_detail.html">Project Detail</a></li>
                  <li><a href="contacts.html">Contacts</a></li>
                  <li><a href="profile.html">Profile</a></li>
                </ul>
              </li>
              <li><a><i class="fa fa-windows"></i> Extras <span class="fa fa-chevron-down"></span></a>
                <ul class="nav child_menu">
                  <li><a href="page_403.html">403 Error</a></li>
                  <li><a href="page_404.html">404 Error</a></li>
                  <li><a href="page_500.html">500 Error</a></li>
                  <li><a href="plain_page.html">Plain Page</a></li>
                  <li><a href="login.html">Login Page</a></li>
                  <li><a href="pricing_tables.html">Pricing Tables</a></li>
                </ul>
              </li>
              <li><a><i class="fa fa-sitemap"></i> Multilevel Menu <span class="fa fa-chevron-down"></span></a>
                <ul class="nav child_menu">
                  <li><a href="#level1_1">Level One</a>
                    <li><a>Level One<span class="fa fa-chevron-down"></span></a>
                      <ul class="nav child_menu">
                        <li class="sub_menu"><a href="level2.html">Level Two</a>
                        </li>
                        <li><a href="#level2_1">Level Two</a>
                        </li>
                        <li><a href="#level2_2">Level Two</a>
                        </li>
                      </ul>
                    </li>
                    <li><a href="#level1_2">Level One</a>
                    </li>-->
                </ul>
                </li>
                <li><a href="javascript:void(0)"><i class="fa fa-laptop"></i> Landing Page <span class="label label-success pull-right">Coming Soon</span></a></li>
            </ul>
          </div>

        </div>
        <!-- /sidebar menu -->


     
        <div class="sidebar-footer hidden-small">
     <!--   <a data-toggle="tooltip" data-placement="top" title="Settings">
            <span class="glyphicon glyphicon-cog" aria-hidden="true"></span>
          </a>-->
          <a data-toggle="tooltip" data-placement="top" title="FullScreen">
            <span class="glyphicon glyphicon-fullscreen" aria-hidden="true"></span>
          </a>
          <a data-toggle="tooltip" data-placement="top" title="Lock">
            <span class="glyphicon glyphicon-eye-close" aria-hidden="true"></span>
          </a>
       <!--   <a data-toggle="tooltip" data-placement="top" title="Logout" href="#" id="closesession">
            <span class="glyphicon glyphicon-off" aria-hidden="true"></span>
          </a>-->
        </div> 
        <script>
// Get the eye close button element
const eyeCloseButton = document.querySelector('.sidebar-footer .glyphicon-eye-close');
// Get the sidebar footer element
const sidebarFooter = document.querySelector('.sidebar-footer');

// Add event listener to the eye close button
eyeCloseButton.addEventListener('click', function() {
  // Hide the sidebar footer
  sidebarFooter.style.display = 'none';
});

// Get the fullscreen button element
const fullscreenButton = document.querySelector('.sidebar-footer .glyphicon-fullscreen');

// Add event listener to the fullscreen button
fullscreenButton.addEventListener('click', function() {
  if (document.documentElement.requestFullscreen) {
    document.documentElement.requestFullscreen();
  } else if (document.documentElement.mozRequestFullScreen) { // Firefox
    document.documentElement.mozRequestFullScreen();
  } else if (document.documentElement.webkitRequestFullscreen) { // Chrome, Safari, and Opera
    document.documentElement.webkitRequestFullscreen();
  } else if (document.documentElement.msRequestFullscreen) { // IE/Edge
    document.documentElement.msRequestFullscreen();
  }
});

          </script>
        <!-- /menu footer buttons -->
      </div>
    </div>

    <!-- top navigation -->
    <div class="top_nav">
      <div class="nav_menu">
        <nav>
          <div class="nav toggle">
            <a id="menu_toggle"><i class="fa fa-bars"></i></a>
          </div>

          <ul class="nav navbar-nav navbar-right">
            <li class="">
              <a href="javascript:;" class="user-profile dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                <img src="" alt="">
                <span class=" fa fa-angle-down"></span>
              </a>
          <ul class="dropdown-menu dropdown-usermenu pull-right">
                 <!--   <li><a href="javascript:;"> Profile</a></li>
                <li>
                  <a href="javascript:;">
                    <span class="badge bg-red pull-right">50%</span>
                    <span>Settings</span>
                  </a>
                </li>
                <li><a href="javascript:;">Help</a></li>-->
                <li>
                  <a href="#" id="logoutButton">
                    <i class="fa fa-sign-out"></i> Log Out
                  </a>
                </li>              </ul>
            </li>

          </ul>
        </nav>
      </div>
    </div>
    <!-- /top navigation -->
 </div>
    <!-- page content -->

  

    <div class="right_col" role="main"><div id="sellSuccessMessage"></div>
<span style="margin-bottom: 10px;" id="onlineStatus"></span>



<div id="loginoverlay">  <div id="errorContainer" class="error-message" style="color: red;"></div>
</div>

    <!-- Add the container for error messages -->

<div id="loginpopup" class="loginpopup">

  <div class="login-container">
  <div class="login-form">
    <h2 style="color: white;">Enter your credentials</h2>
    <!-- Use a form to handle form submission -->
    <form id="loginForm">
      <label style="color: white;" for="email">Email:</label>
      <input type="email" id="email" required>
      <label style="color: white;" for="password">Password:</label>
      <input type="password" id="password" required>
      <button type="submit"  id="submitBtn">Submit</button>
      <!-- Add a link for Forgot Password -->
      <a href="#" id="forgotPasswordLink" style="color: white;">Forgot Password?</a>
    </form>
  </div>
  <!-- Details about Bibo Medical Systems -->
  <div class="bibo-details">
    <h3 style="color: rgb(255, 255, 255);" class="title">
      <i class="fas fa-hospital"></i> Bibo Medical Systems | Your Healthcare Assistant
    </h3>
    <p style="color: rgb(255, 255, 255);">
      Bibo Medical Systems is a state-of-the-art Hospital Management System that aims to revolutionize healthcare services. With cutting-edge technology and a team of dedicated healthcare professionals, we provide comprehensive medical solutions to enhance patient care and streamline hospital operations.
    </p>
    <p style="color: rgb(255, 255, 255);">
      Our advanced system offers features such as electronic health records (EHR), patient billing, pharmacy management, and more. We prioritize data security and ensure that patient information remains confidential and protected.
    </p>
<!--   <p style="color: rgb(255, 255, 255);">
      At Bibo Medical Systems, we focus on patient-centric care, providing personalized treatment plans and fostering a compassionate environment for healing. Our hospital management system optimizes workflows, reduces administrative burdens, and empowers healthcare providers to deliver efficient and effective services.
    </p>--> 
    <p style="color: rgb(255, 255, 255);">
      Whether you're a patient seeking top-notch medical care or a healthcare professional looking to streamline hospital operations, Bibo Medical Systems is your reliable healthcare assistant.
    </p>
    <p style="color: rgb(255, 255, 255);">
      Experience the future of healthcare management with Bibo Medical Systems. Your well-being is our priority, and we are committed to delivering excellence in healthcare services every step of the way.
    </p>
  </div>
</div>
</div>
<section class="welcome">
  <div>
    <h2 class="wel-head">
      <span class="icon">&#128202;</span> Welcome to the Dashboard
    </h2>
   

  </div>
   <div id="greeting"></div>
  </section>
  
<h2>Hospital Survey</h2>
  <section class="intro">
    <div class="survey-item">
      <i style="color: green;" class="fa fa-user-md"></i>
      <span class="count2" id="staffCount">0</span>
      <h3>Staff</h3>
    </div>
    <div class="survey-item">
      <i style="color: brown;" class="fa fa-users"></i>
      <span class="count2" id="patientsCount">0</span>
      <h3>Patients</h3>
    </div>
    
    <div class="survey-item">
      <i style="color: orange;" class="fa fa-shopping-cart"></i>
      <span class="count2" id="salesCount">0</span>
      <h3>Sales Count</h3>
    </div>
    
  </section>


  <div id="overlay"></div>
<div id="message"></div>

<!-- The popup div -->
<div id="popupContainer" class="popup-container4" >
  <div>
    <span class="close-button" id="closeButton">&times;</span>
    <h2>Expense Details</h2>
    <label for="expense">Expense:</label>
    <input type="text" id="expense" required>
    <label for="amount">Amount (UGX):</label>
    <input type="number" id="amount" required>
    <button id="saveExpenseButton">Save</button>
  </div>
</div><!-- Button with an "add" icon -->

<!-- The overlay -->
<div id="schemeOverlay"></div>

<!-- The popup div for schemed expenses -->
<div id="schemePopupContainer" class="popup-container4">
  <div>
    <span class="close-button" id="schemeCloseButton">&times;</span>
    <h2>Upload Schemed Expense</h2>
    <label for="schemeExpense">Expense:</label>
    <input type="text" id="schemeExpense" required>
    <label for="schemeAmount">Amount (UGX):</label>
    <input type="number" id="schemeAmount" required>
    <label for="schemePayment">Scheme of Payment:</label>
    <select id="schemePayment">
      <option value="monthly">Monthly</option>
      <option value="yearly">Yearly</option>
      <option value="after_2_years">After 2 years</option>
      <option value="after_3_years">After 3 years</option>
      <option value="after_5_years">After 5 years</option>
    </select>
    <button id="saveSchemeExpenseButton">Save</button>
  </div>
</div>


<section>
  <!-- Filter by Date -->
  <h2 style="color: white;">Filter Daily Expenses</h2>
  <div>
  <label style="color: white;" for="startDate">Start Date:</label>
  <input type="date" id="dailystartDate"></div>
  <div>
  <label style="color: white" for="endDate">End Date:</label>
  <input type="date" id="dailyendDate"></div>
  <button id="filterByDateButton"><i class="fas fa-filter"></i> Filter by Date</button>
</section>
<button id="openSchemePopupButton">
  <i class="fas fa-plus-circle"></i> Schemed Expense
</button>

<button id="openPopupButton">
   <i class="fas fa-plus-circle"></i> Daily Expense
  </button>
<!-- The container for the daily expenses table -->
<div id="dailyExpensesContainer">
  <h2>Daily Expenses</h2>
  <table id="dailyExpensesTable" class="expense-table">
    <thead>
      <tr>
        <th><i style="color: green;" class="fas fa-file-invoice-dollar"></i> Expense</th>
        <th><i style="color: darkblue;" class="fas fa-money-bill-alt"></i> Amount (UGX)</th>
        <th><i style="color: green;" class="fas fa-calendar-day"></i> Date</th>
        <th><i style="color: blue;" class="fas fa-cogs"></i> Actions</th>
      </tr>
    </thead>
    <tbody id="dailyExpensesBody">
      <!-- Daily expenses rows will be added here -->
    </tbody>
  </table>
</div>
<!-- Add this div to display the total sum -->


<!-- The container for the schemed expenses table -->
<div id="schemedExpensesContainer">
  <h2>Schemed Expense Billing  Rate</h2>
  <div class="total-sums-container">
    <div class="total-sum-card" id="totalSumMonthly"></div>
    <div class="total-sum-card" id="totalSumYearly"></div>
    <div class="total-sum-card" id="totalSumAfter2Years"></div>
    <div class="total-sum-card" id="totalSumAfter3Years"></div>
    <div class="total-sum-card" id="totalSumAfter5Years"></div>
  </div>
  
  <h2>Schemed Expense Overview</h2>
  <table id="schemedExpensesTable" class="expense-table">
    <thead>
      <tr>
        <th><i style="color: green;" class="fas fa-file-invoice-dollar"></i> Expense</th>
        <th><i style="color: darkblue;" class="fas fa-money-bill-alt"></i> Amount (UGX)</th>
        <th><i style="color: maroon;" class="fas fa-calendar-alt"></i> Scheme of Payment</th>
        <th><i style="color: green;" class="fas fa-calendar-day"></i> Start Date</th>
        <th><i style="color: purple;" class="fas fa-calendar-check"></i> Due Date</th>
        <th><i style="color: orange;" class="fas fa-hourglass-half"></i> Days Left</th>
        <th><i style="color: blue;" class="fas fa-cogs"></i> Actions</th>
      </tr>
    </thead>
    <tbody id="schemedExpensesBody">
      <!-- Schemed expenses rows will be added here -->
    </tbody>
  </table>
</div>

    <section>
      <h1  style="color: white; text-decoration: none;" >Test's  analytics</h1>        
<br>
    <div>
      <label style="color: white;" for="start-date2">Start Date:</label>
      <input type="date" id="start-date2">
    </div>

    <div>
      <label style="color: white;" for="end-date2">End Date:</label>
      <input type="date" id="end-date2">
    </div>

    <button id="filter-button2"><i class="fas fa-filter"></i> Filter</button>
    <button id="clear-filter-button2"><i class="fas fa-refresh"></i> Refresh Filter</button>

</section>
<!-- Add this div to display the total price -->
<div id="total-price"></div>

       <!-- Table container -->
  <div id="test-table-container">
    <!-- The fetched test data will be displayed here -->
  </div>
             <section>
                <h1  style="color: white; text-decoration: none;" > Medicine sale's  analytics</h1>
                <div>
                <label style="color: white;" for="start-date">Start Date:</label>
            <input type="date" id="start-date">
      </div>
      <div>
            <label style="color: white;" for="start-date">End Date:</label>
      <input type="date" id="end-date"></div>
      <button id="filter-button"><i class="fas fa-filter"></i> Filter</button>
      <button id="clear-filter-button"><i class="fas fa-refresh"></i> Refresh Filter</button>
    
    </section>
   <div class="search-container">
          <h2 style="margin-top: 20px;" >Search Medicine</h2>
          <input type="text" id="medicineInput" placeholder="Enter medicine name">
          <button id="searchMedicineButton">Search</button>   
         
              </div>
                   <div id="loader" class="loader"></div>
                
      



  <canvas id="salesChart"></canvas>

  <div class="text">
    <h3 class="trend">Total revenue collected from medicine.</h3>
    <div style="background-color: #fff; padding: 15px; border-radius: 10px; width: fit-content;" id="totalAmount"></div>
       <div>
    <h3 class="trend">Top Medicines <span class="icon">&#128202;</span> </h3>
    <div id="topsells"></div>
    </div> 
    </div>


  
  <style>
/* The overlay */
#schemeOverlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.7);
  z-index: 1;
  display: none;
}

/* The popup div for schemed expenses */
#schemePopupContainer {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background-color: #fff;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
  padding: 20px;
  z-index: 2;
  display: none;
}

.popup-content {
  width: 300px;
}

.close-button {
  position: absolute;
  top: 10px;
  right: 10px;
  font-size: 18px;
  cursor: pointer;
}

h2 {
  margin-bottom: 10px;
}

label {
  display: block;
  margin-bottom: 5px;
}

input[type="text"],
input[type="number"],
select {
  width: 100%;
  padding: 8px;
  margin-bottom: 15px;
  border: 1px solid #ccc;
  border-radius: 4px;
}

button {
  background-color: #4CAF50;
  color: #fff;
  border: none;
  padding: 10px 20px;
  border-radius: 4px;
  cursor: pointer;
}

button:hover {
  background-color: #45a049;
}

/* Show the popup when it's active */
#schemePopupContainer.active,
#schemeOverlay.active {
  display: block;
}

.text {
  background: #73C8A9;  /* fallback for old browsers */
background: -webkit-linear-gradient(to right, #373B44, #73C8A9);  /* Chrome 10-25, Safari 5.1-6 */
background: linear-gradient(to right, #373B44, #73C8A9); /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */

  padding: 20px;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
  margin-top: 100px;
  margin-bottom: 50px;
}

.trend {
  color: #ffffff;
  font-size: 24px;
  margin-bottom: 10px;
}

label {
  display: block;
  margin-bottom: 5px;
  font-weight: bold;
  color: #333;
}

input[type="text"],
input[type="number"] {
  width: 100%;
  padding: 8px;
  border: 1px solid #ccc;
  border-radius: 5px;
  font-size: 14px;
}

button {
  background-color: #007BFF;
  color: #fff;
  border: none;
  border-radius: 5px;
  padding: 10px 20px;
  font-size: 14px;
  cursor: pointer;
  margin-top: 10px;
}
#totalAmount {
  color: #ff3366;
  font-size: 36px;
  margin-bottom: 20px;
}
/* CSS for the top selling medicines table */
.topsell-table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
  color: white;
}

.topsell-table th, .topsell-table td {
  padding: 10px;
  text-align: left;
  border-bottom: 1px solid #ddd;
}

.topsell-table th {
background: #f9f9f9;
  font-weight: bold;
  color: rgb(63, 63, 63);
}

.topsell-table tr:hover {
  background-color: #f9f9f9;
  color: rgb(0, 0, 0);

}



    .earnings-icon {
   font-size: 34px;
   color: #ffbb00; /* Adjust the color as desired */
   background: #136a8a;  /* fallback for old browsers */
background: -webkit-linear-gradient(to right, #267871, #136a8a);  /* Chrome 10-25, Safari 5.1-6 */
background: linear-gradient(to right, #267871, #136a8a); /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */
   padding: 10px;
   border-radius: 50px;
}

.earnings-text {
  font-size: 30px;
  color: #333; /* Adjust the color as desired */
}

  </style>
 <section  style="color: white;">
  <h1  style="color: white; text-decoration: none;" >Trend of Sales Made Over Days</h1>
 </section>
  <canvas id="salesTrendChart"></canvas>
 <!-- <section  style="color: white; width: fit-content; margin-top: 90px;">
    <h1  style="color: white; text-decoration: none;" >Table of Sales Made Over Days</h1>
   </section>-->
        <div id="patients" class="patients-container"></div>
        <div id="salesContainer"></div>

            <div id="noResultsMessage"></div>
   
        
      </div>
  

    <!-- /page content -->


 <!-- Firebase libraries -->
<script type="module" src="https://www.gstatic.com/firebasejs/9.0.2/firebase-app.js"></script>
<script type="module" src="https://www.gstatic.com/firebasejs/9.0.2/firebase-database.js"></script>
<script type="module" src="https://www.gstatic.com/firebasejs/9.0.2/firebase-auth.js"></script>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.2/firebase-app.js";
  import { getDatabase,update, ref,remove, push,get, onValue,child,set } from "https://www.gstatic.com/firebasejs/9.0.2/firebase-database.js";
  import { getAuth, onAuthStateChanged,sendPasswordResetEmail , signInWithEmailAndPassword, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/9.0.2/firebase-auth.js";
  const firebaseConfig = {
    apiKey: "AIzaSyCi_hufIZTzsYtdPGQtvtmKmAkkrydmn_A",
  authDomain: "abbah-83a7b.firebaseapp.com",
  databaseURL: "https://abbah-83a7b-default-rtdb.firebaseio.com",
  projectId: "abbah-83a7b",
  storageBucket: "abbah-83a7b.appspot.com",
  messagingSenderId: "379729759051",
  appId: "1:379729759051:web:e75528d61b02d1e4f536ce",
  measurementId: "G-H41J2WMR6S"
  };

  const app = initializeApp(firebaseConfig);
const database = getDatabase(app);
const auth = getAuth(app); // Initialize Firebase Authentication


function showMessage(message) {
  const messageElement = document.getElementById('message');
  messageElement.textContent = message;
  messageElement.style.display = 'block';

  // Hide the message after 4 seconds (4000 milliseconds)
  setTimeout(() => {
    messageElement.style.display = 'none';
  }, 4000);
}

// Call showMessage with an empty message to hide the message on page load
showMessage('');

       
// Ensure that authToken is defined in the global scope
let authToken;
let tokenExpiryTime;

// Function to generate a token valid for 24 hours
function generateToken() {
  authToken = Math.random().toString(36).substring(2);
  const currentTime = new Date();
  const tokenExpiryTime = new Date(currentTime.getTime() + 24 * 60 * 60 * 1000); // Token valid for 24 hours

  // Store token and expiry time in local storage
  localStorage.setItem('authToken', authToken);
  localStorage.setItem('tokenExpiryTime', tokenExpiryTime.toString());
}


// Function to retrieve token and its expiry time from local storage
function retrieveTokenFromLocalStorage() {
  authToken = localStorage.getItem('authToken');
  const storedExpiryTime = localStorage.getItem('tokenExpiryTime');
  if (authToken && storedExpiryTime) {
    tokenExpiryTime = new Date(storedExpiryTime);
  }
}

// Function to check if the token is still valid
function isTokenValid() {
  const currentTime = new Date();
  return tokenExpiryTime > currentTime;
}

// Function to display the login overlay on page load based on token validity
window.addEventListener('load', function() {
  retrieveTokenFromLocalStorage(); // Retrieve token from local storage
  // Check if token is valid, if not, display login overlay
  if (!isTokenValid()) {
    document.getElementById('loginoverlay').style.display = 'block';
    document.getElementById('loginpopup').style.display = 'block';
    generateToken(); // Generate a new token on login overlay display
    console.log(authToken + tokenExpiryTime)
  }
});

// Rest of your code...


 // Disable right-click when the popup is displayed
document.addEventListener('contextmenu', function(event) {
  if (document.getElementById('loginpopup').style.display === 'block') {
    event.preventDefault();
  }
  document.addEventListener('keydown', function(event) {
  if (event.keyCode === 123) {
    event.preventDefault();
  }
});

});
const allowedEmails = ['biboofficial256@gmail.com']; // Add the allowed email addresses here

// Show a loader inside the submit button when it's clicked
document.getElementById('loginForm').addEventListener('submit', function(event) {
  event.preventDefault(); // Prevent default form submission

  // Show loader inside the submit button
  const submitBtn = document.getElementById('submitBtn');
  submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Submitting';

  // Get user credentials from the form
  const email = document.getElementById('email').value;
  const password = document.getElementById('password').value;

// Update the login success block to generate a new token and store it
signInWithEmailAndPassword(auth, email, password)
  .then((userCredential) => {
    // Check if the user's email is allowed
    if (allowedEmails.includes(email)) {
      // Login successful, hide the login overlay and popup
      document.getElementById('loginoverlay').style.display = 'none';
      document.getElementById('loginpopup').style.display = 'none';
      generateToken(); // Generate a new token on successful login
      } else {
        // Login not allowed, show an error message
        const errorContainer = document.getElementById('errorContainer');
        errorContainer.textContent = 'Access denied. You are not authorized.';
        errorContainer.style.display = 'block'; // Show the message
        // Log out the user since they are not authorized
        signOut(auth)
          .then(() => {
            // Reset the submit button text after a short delay (e.g., 2 seconds)
            setTimeout(function() {
              submitBtn.innerHTML = 'Submit';
            }, 2000);
          })
          .catch((error) => {
            console.error('Error signing out:', error);
          });
      }
    })
    .catch((error) => {
      // Login failed, display error message
      const errorMessage = error.message;
      const errorContainer = document.getElementById('errorContainer');
      errorContainer.textContent = errorMessage;
      errorContainer.style.display = 'block'; // Show the message

      // Reset the submit button text after a short delay (e.g., 2 seconds)
      setTimeout(function() {
        submitBtn.innerHTML = 'Submit';
      }, 2000);
    });
});



// Event listener for the "Forgot Password" link
document.getElementById('forgotPasswordLink').addEventListener('click', function(event) {
  event.preventDefault();

  // Get the email entered by the user
  const email = document.getElementById('email').value;

  // Use Firebase sendPasswordResetEmail method with auth object
  sendPasswordResetEmail(auth, email)
    .then(() => {
      // Password reset email sent successfully
      showMessage(' A password reset email has been sent. Please check your inbox.');
    })
    .catch((error) => {
      // Password reset email failed to send
      const errorMessage = error.message;
      alert('Password reset email failed to send. ' + errorMessage);
    });
});
// Function to display a message with optional retry button and success flag
function displayMessage(title, message, isSuccess = false) {
  // Clear existing messages
  const existingMessages = document.querySelectorAll('.retry-message');
  existingMessages.forEach(function (message) {
    message.remove();
  });

  // Create a div element for the message
  const messageDiv = document.createElement('div');
  messageDiv.classList.add('retry-message'); // Add the class for styling

  // Set background color to green for success message
  if (isSuccess) {
    messageDiv.style.backgroundColor = '#4caf50';
  }

  // Create close button element
  const closeButton = document.createElement('button');
  closeButton.classList.add('close-btn');
  closeButton.innerHTML = '<i class="fa fa-times"></i>';
  closeButton.addEventListener('click', function () {
    messageDiv.remove();
  });

  // Create title element
  const titleElement = document.createElement('h2');
  titleElement.textContent = title;

  // Create message element
  const messageElement = document.createElement('p');
  messageElement.textContent = message;

  // Append title, message, and close button to the message div
  messageDiv.appendChild(titleElement);
  messageDiv.appendChild(messageElement);
  //messageDiv.appendChild(closeButton);

  // Append the message div to the document body
  document.body.appendChild(messageDiv);

  // Automatically remove the message after 5 seconds (5000 milliseconds)
  setTimeout(function () {
    messageDiv.remove();
  }, 1500);
}
// Function to display user information
function displayUserInformation(user) {
  // Set the h2 element text to the user's display name
  const profileName = document.querySelector('.profile_info h2');
  profileName.textContent = user.displayName;

  // Set the profile image source to the user's profile photo URL
  const profileImage = document.querySelector('.profile_pic img');
  profileImage.src = user.photoURL;

  // Set the profile image in the dropdown menu
  const dropdownProfileImage = document.querySelector('.user-profile img');
  dropdownProfileImage.src = user.photoURL;

  // Display success message
  displayMessage('', `Welcome, ${user.displayName}.`, true); // Pass true for success message

  // Reload the page content or perform any necessary actions for an authenticated user
}

// Function to handle sign-in success
function handleSignInSuccess(user) {
  // Display user information
  displayUserInformation(user);
}

// Function to handle sign-in error
function handleSignInError(error) {
  console.error('Error signing in:', error);
  // Display access denied message
  displayMessage('Access Denied. Please sign in with a valid email.');
}

// Function to sign in with Google
function signInWithGoogle() {
  var provider = new GoogleAuthProvider();
  signInWithPopup(auth, provider)
    .then(function (result) {
      const user = result.user;
      handleSignInSuccess(user);
    })
    .catch(function (error) {
      handleSignInError(error);
    });
}

// Display the email sign-in popup on page load
window.addEventListener('load', function() {
  auth.onAuthStateChanged(function(user) {
    if (user) {
      // User is signed in
      displayUserInformation(user);
    } else {
      // User is not signed in, display the sign-in popup
      signInWithGoogle();
    }
  });
});

// Function to retry the sign-in process
function retryCallback() {
  signInWithGoogle();
}



const staffRef = ref(database, "staff");

// Get the number of staff
get(staffRef)
  .then(snapshot => {
    const staffData = snapshot.val();
    const staffCount = Object.keys(staffData).length;

    // Update the staff count in the HTML
    const staffCountElement = document.getElementById("staffCount");
    if (staffCountElement) {
      staffCountElement.innerText = staffCount.toString();
    }
  })
  .catch(error => {
    console.error("Error fetching staff count:", error);
  });

const patientsRef2 = ref(database, "patients");

// Get the number of staff
get(patientsRef2)
  .then(snapshot => {
    const patientsData = snapshot.val();
    const patientsCount = Object.keys(patientsData).length;

    // Update the staff count in the HTML
    const patientsCountElement = document.getElementById("patientsCount");
    if (patientsCountElement) {
     patientsCountElement.innerText = patientsCount.toString();
    }
  })
  .catch(error => {
    console.error("Error fetching staff count:", error);
  });


// Function to filter daily expenses by date
function filterExpensesByDate() {
  const startDateValue = document.getElementById('dailystartDate').value;
  const endDateValue = document.getElementById('dailyendDate').value;

  if (!startDateValue || !endDateValue) {
    alert('Please select both start and end dates.');
    return;
  }

  const startDate = new Date(startDateValue);
  const endDate = new Date(endDateValue);

  fetchAndDisplayDailyExpenses(startDate, endDate);
}

// Function to render the filtered daily expenses in the table
function renderFilteredDailyExpenses(filteredExpenses) {
  const dailyExpensesTableBody = document.getElementById('dailyExpensesBody');
  dailyExpensesTableBody.innerHTML = '';

  filteredExpenses.forEach((expense) => {
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${expense.expense}</td>
      <td>${expense.amount.toLocaleString('en-US', { style: 'currency', currency: 'UGX' })}</td>
      <td>${expense.date}</td>
      <td>
        <button class="delete-button2" onclick="deleteDailyExpense('${expense.key}')">Delete</button>
      </td>
    `;

    dailyExpensesTableBody.appendChild(row);
  });
}

       // Add event listener to the "Filter by Date" button
       document.getElementById('filterByDateButton').addEventListener('click', filterExpensesByDate);


  // Function to fetch and display the daily expenses in the table
function fetchAndDisplayDailyExpenses(startDate, endDate) {
  const dailyExpensesRef = ref(database, 'daily_expenses');

  onValue(dailyExpensesRef, (snapshot) => {
    const dailyExpensesData = snapshot.val();

    if (dailyExpensesData) {
      const dailyExpensesTableBody = document.getElementById('dailyExpensesBody');
      dailyExpensesTableBody.innerHTML = '';

      for (const key in dailyExpensesData) {
        const expenseData = dailyExpensesData[key];

        // Parse the date from the data
        const expenseDate = new Date(expenseData.date);

        // Check if the expense date falls within the selected date range
        if (!startDate || !endDate || (expenseDate >= startDate && expenseDate <= endDate)) {
          // Format the date in MM/DD/YYYY format
          const formattedDate = expenseDate.toLocaleDateString('en-US');

          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${expenseData.expense}</td>
            <td>${expenseData.amount.toLocaleString('en-US', { style: 'currency', currency: 'UGX' })}</td>
            <td>${formattedDate}</td>
            <td>
              <button class="delete-button2" data-key="${key}">Delete</button>
            </td>
          `;

          dailyExpensesTableBody.appendChild(row);
        }
      }

      // Add event listeners to the "Delete" buttons
      const deleteButtons2 = document.querySelectorAll('.delete-button2');
      deleteButtons2.forEach((button) => {
        button.addEventListener('click', function () {
          const key = this.dataset.key;
          deleteDailyExpense(key);
        });
      });
    }
  });
}

// Function to delete a daily expense by its key
function deleteDailyExpense(expenseKey) {
  // Ask the user to enter the password
  const enteredPassword = window.prompt('Enter the password to delete the expense:');
  const correctPassword = 'mm'; // Replace 'your_password_here' with the actual password

  if (enteredPassword === correctPassword) {
    const dailyExpensesRef = ref(database, 'daily_expenses');

    // Get a reference to the specific daily expense to delete
    const expenseToDeleteRef = child(dailyExpensesRef, expenseKey);

    // Remove the daily expense from Firebase
    remove(expenseToDeleteRef)
      .then(() => {
        showMessage('Daily expense deleted successfully!');
      })
      .catch((error) => {
        showMessage('Error deleting daily expense:', error);
      });
  } else {
    showMessage('Password incorrect. Deletion canceled.');
  }
}


// Fetch and display the daily expenses in the table when the DOM content is loaded
document.addEventListener('DOMContentLoaded', () => {
  fetchAndDisplayDailyExpenses();
});

// Function to calculate and display the total sum of expenses
function calculateAndDisplayTotalSums(expensesData) {
  let totalSumMonthly = 0;
  let totalSumYearly = 0;
  let totalSumAfter2Years = 0;
  let totalSumAfter3Years = 0;
  let totalSumAfter5Years = 0;

  for (const key in expensesData) {
    const expenseData = expensesData[key];
    switch (expenseData.scheme) {
      case 'monthly':
        totalSumMonthly += expenseData.amount;
        break;
      case 'yearly':
        totalSumYearly += expenseData.amount;
        break;
      case 'after_2_years':
        totalSumAfter2Years += expenseData.amount;
        break;
      case 'after_3_years':
        totalSumAfter3Years += expenseData.amount;
        break;
      case 'after_5_years':
        totalSumAfter5Years += expenseData.amount;
        break;
      default:
        break;
    }
  }

  const totalSumMonthlyDiv = document.getElementById('totalSumMonthly');
  totalSumMonthlyDiv.textContent = `Billed (Monthly): ${totalSumMonthly.toLocaleString('en-US', {
    style: 'currency',
    currency: 'UGX',
  })}`;

  const totalSumYearlyDiv = document.getElementById('totalSumYearly');
  totalSumYearlyDiv.textContent = `Billed  (Yearly): ${totalSumYearly.toLocaleString('en-US', {
    style: 'currency',
    currency: 'UGX',
  })}`;

  const totalSumAfter2YearsDiv = document.getElementById('totalSumAfter2Years');
  totalSumAfter2YearsDiv.textContent = `Billed  (After 2 Years): ${totalSumAfter2Years.toLocaleString('en-US', {
    style: 'currency',
    currency: 'UGX',
  })}`;

  const totalSumAfter3YearsDiv = document.getElementById('totalSumAfter3Years');
  totalSumAfter3YearsDiv.textContent = `Billed  (After 3 Years): ${totalSumAfter3Years.toLocaleString('en-US', {
    style: 'currency',
    currency: 'UGX',
  })}`;

  const totalSumAfter5YearsDiv = document.getElementById('totalSumAfter5Years');
  totalSumAfter5YearsDiv.textContent = `Billed  (After 5 Years): ${totalSumAfter5Years.toLocaleString('en-US', {
    style: 'currency',
    currency: 'UGX',
  })}`;
}

// Function to fetch and display the schemed expenses in the table
function fetchAndDisplaySchemedExpenses() {
  const schemedExpensesRef = ref(database, 'schemed_expenses');

  onValue(schemedExpensesRef, (snapshot) => {
    const schemedExpensesData = snapshot.val();

    if (schemedExpensesData) {
      const schemedExpensesTableBody = document.getElementById('schemedExpensesBody');
      schemedExpensesTableBody.innerHTML = '';

      for (const key in schemedExpensesData) {
        const expenseData = schemedExpensesData[key];

        // Format the date in MM/DD/YYYY format
        const formattedDate = new Date(expenseData.date).toLocaleDateString('en-US');

        // Calculate the due date based on the payment scheme
        const paymentScheme = expenseData.scheme;
        const startDate = new Date(expenseData.date);
        let dueDate;
        if (paymentScheme === 'monthly') {
          dueDate = new Date(startDate);
          dueDate.setMonth(startDate.getMonth() + 1);
        } else if (paymentScheme === 'yearly') {
          dueDate = new Date(startDate);
          dueDate.setFullYear(startDate.getFullYear() + 1);
        } else if (paymentScheme === 'after_2_years') {
          dueDate = new Date(startDate);
          dueDate.setFullYear(startDate.getFullYear() + 2);
        } else if (paymentScheme === 'after_3_years') {
          dueDate = new Date(startDate);
          dueDate.setFullYear(startDate.getFullYear() + 3);
        } else if (paymentScheme === 'after_5_years') {
          dueDate = new Date(startDate);
          dueDate.setFullYear(startDate.getFullYear() + 5);
        }

        // Format the due date in MM/DD/YYYY format
        const formattedDueDate = dueDate.toLocaleDateString('en-US');

        // Calculate the number of days left between current date and due date
        const currentDate = new Date();
        const daysLeft = Math.ceil((dueDate - currentDate) / (1000 * 60 * 60 * 24));

        // Determine the text color for the "Days Left" column based on the number of days
        let daysLeftColorClass;
        if (daysLeft <= 0) {
          daysLeftColorClass = 'red-text';
        } else if (daysLeft <= 10) {
          daysLeftColorClass = 'orange-text';
        } else {
          daysLeftColorClass = 'green-text';
        }

        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${expenseData.expense}</td>
          <td>${expenseData.amount.toLocaleString('en-US', { style: 'currency', currency: 'UGX' })}</td>
          <td>${expenseData.scheme}</td>
          <td>${formattedDate}</td>
          <td>${formattedDueDate}</td>
          <td class="${daysLeftColorClass}">${daysLeft} days</td>
          <td>
            <button class="delete-button" data-key="${key}">Delete</button>
            <button class="renew-button" data-key="${key}">Renew</button>
          </td>
        `;

        schemedExpensesTableBody.appendChild(row);
      }

      // Add event listeners to the "Delete" buttons
      const deleteButtons = document.querySelectorAll('.delete-button');
      deleteButtons.forEach((button) => {
        button.addEventListener('click', function () {
          const key = this.dataset.key;
          deleteExpense(key);
        });
      });

      // Add event listeners to the "Renew" buttons
      const renewButtons = document.querySelectorAll('.renew-button');
      renewButtons.forEach((button) => {
        button.addEventListener('click', function () {
          const key = this.dataset.key;
          renewExpense(key);
        });
      });
        // Call the function to calculate and display the total sum
        calculateAndDisplayTotalSums(schemedExpensesData);
    }    
  });
}

// Function to delete the expense from Firebase
function deleteExpense(key) {
  // Ask the user to enter the password
  const enteredPassword = window.prompt('Enter the password to delete the expense:');
  const correctPassword = 'mm'; // Replace 'your_password_here' with the actual password

  if (enteredPassword === correctPassword) {
    const expenseRef = ref(database, `schemed_expenses/${key}`);
    remove(expenseRef)
      .then(() => {
        showMessage('Expense deleted successfully!');
      })
      .catch((error) => {
        showMessage('Error deleting expense:', error);
      });
  } else {
    showMessage('Password incorrect. Deletion canceled.');
  }
}

// Function to renew the expense with the current date in Firebase
function renewExpense(key) {
  // Ask the user to enter the password
  const enteredPassword = window.prompt('Enter the password to renew the expense:');
  const correctPassword = 'mm'; // Replace 'your_password_here' with the actual password

  if (enteredPassword === correctPassword) {
    const expenseRef = ref(database, `schemed_expenses/${key}`);
    const currentDate = new Date().toISOString();

    update(expenseRef, {
      date: currentDate
    })
      .then(() => {
        showMessage('Expense renewed successfully!');
      })
      .catch((error) => {
        showMessage('Error renewing expense:', error);
      });
  } else {
    showMessage('Password incorrect. Renewal canceled.');
  }
}


// Call the functions to fetch and display the expenses data
fetchAndDisplayDailyExpenses();
fetchAndDisplaySchemedExpenses();



// Function to save the schemed expense details to Firebase
function saveSchemeExpense(expense, amount, scheme) {
  const schemeExpensesRef = ref(database, 'schemed_expenses');
  const newSchemeExpenseRef = push(schemeExpensesRef);

  // Get the current date and time
  const currentDate = new Date();
  const currentDateTimeString = currentDate.toISOString(); // Convert to ISO string format

  // Create an object with the scheme expense details
  const schemeExpenseData = {
    expense: expense,
    amount: amount,
    scheme: scheme,
    date: currentDateTimeString // Add the date and time to the object
  };

  // Save the scheme expense data to Firebase
  set(newSchemeExpenseRef, schemeExpenseData)
    .then(() => {
      showMessage('Schemed expense details saved successfully!');
    })
    .catch((error) => {
      showMessage('Error saving schemed expense details:', error);
    });
}


// Add event listener to the "Save" button in the scheme popup
const saveSchemeExpenseButton = document.getElementById('saveSchemeExpenseButton');
saveSchemeExpenseButton.addEventListener('click', function () {
  const schemeExpenseInput = document.getElementById('schemeExpense');
  const schemeAmountInput = document.getElementById('schemeAmount');
  const schemePaymentSelect = document.getElementById('schemePayment');

  const schemeExpense = schemeExpenseInput.value.trim();
  const schemeAmount = parseFloat(schemeAmountInput.value);
  const schemePayment = schemePaymentSelect.value;

  if (schemeExpense && !isNaN(schemeAmount) && schemeAmount > 0) {
    // Save the schemed expense details to Firebase
    saveSchemeExpense(schemeExpense, schemeAmount, schemePayment);

    // Clear the input fields
    schemeExpenseInput.value = '';
    schemeAmountInput.value = '';
    
    // Close the scheme popup
    closeSchemePopup();
  } else {
    alert('Please enter valid expense and amount.');
  }
});

// Function to open the scheme popup
function openSchemePopup() {
  const schemePopupContainer = document.getElementById('schemePopupContainer');
  const schemeOverlay = document.getElementById('schemeOverlay');
  schemePopupContainer.classList.add('active');
  schemeOverlay.classList.add('active');
}

// Function to close the scheme popup
function closeSchemePopup() {
  const schemePopupContainer = document.getElementById('schemePopupContainer');
  const schemeOverlay = document.getElementById('schemeOverlay');
  schemePopupContainer.classList.remove('active');
  schemeOverlay.classList.remove('active');
}

// Add event listener to the "Open Scheme Popup" button
const openSchemePopupButton = document.getElementById('openSchemePopupButton');
openSchemePopupButton.addEventListener('click', openSchemePopup);

// Add event listener to the "Close" button in the scheme popup
const schemeCloseButton = document.getElementById('schemeCloseButton');
schemeCloseButton.addEventListener('click', closeSchemePopup);


// Function to save the expense details to Firebase
function saveExpenseDetails(expense, amount) {
  const expensesRef = ref(database, 'daily_expenses');
  const newExpenseRef = push(expensesRef);

  // Get the current date and time
  const currentDate = new Date();

  // Create an object with the expense details
  const expenseData = {
    expense: expense,
    amount: amount,
    date: currentDate.toISOString() // Convert the date to a string in ISO format
  };

  // Save the expense data to Firebase
  set(newExpenseRef, expenseData)
    .then(() => {
      showMessage('Expense details saved successfully!');
    })
    .catch((error) => {
      showMessage('Error saving expense details:', error);
    });
}

// Add event listener to the "Save" button in the popup
const saveExpenseButton = document.getElementById('saveExpenseButton');
saveExpenseButton.addEventListener('click', function () {
  const expenseInput = document.getElementById('expense');
  const amountInput = document.getElementById('amount');

  const expense = expenseInput.value.trim();
  const amount = parseFloat(amountInput.value);

  if (expense && !isNaN(amount) && amount > 0) {
    // Save the expense details to Firebase
    saveExpenseDetails(expense, amount);

    // Clear the input fields
    expenseInput.value = '';
    amountInput.value = '';
    
    // Close the popup
    closePopup();
  } else {
    alert('Please enter valid expense and amount.');
  }
});

// Function to open the popup
function openPopup() {
  const popupContainer = document.getElementById('popupContainer');
  const overlay = document.getElementById('overlay');
  popupContainer.classList.add('active');
  overlay.classList.add('active');
}

// Function to close the popup
function closePopup() {
  const popupContainer = document.getElementById('popupContainer');
  const overlay = document.getElementById('overlay');
  popupContainer.classList.remove('active');
  overlay.classList.remove('active');
}


const openPopupButton = document.getElementById('openPopupButton');
const popupContainer = document.getElementById('popupContainer');
const overlay = document.getElementById('overlay');
const closeButton = document.getElementById('closeButton');

openPopupButton.addEventListener('click', () => {
  popupContainer.style.display = 'block';
  overlay.style.display = 'block';
});

closeButton.addEventListener('click', () => {
  popupContainer.style.display = 'none';
  overlay.style.display = 'none';
});

// Assuming you have already initialized Firebase and have a reference to the database
// Add event listener to the "Clear Filter" button
const clearFilterButton2 = document.getElementById('clear-filter-button2');
clearFilterButton2.addEventListener('click', function () {
  // Reset the date inputs
  document.getElementById('start-date2').value = '';
  document.getElementById('end-date2').value = '';

  // Display all tests again
  fetchAndDisplayTests();
});

// Add event listener to the "Filter" button
const filterButton2 = document.getElementById('filter-button2');
filterButton2.addEventListener('click', function () {
  // Get the selected start and end dates
  const startDateValue = document.getElementById('start-date2').value;
  const endDateValue = document.getElementById('end-date2').value;

  // Convert the date strings to Date objects
  const startDate2 = new Date(startDateValue);
  const endDate2 = new Date(endDateValue);

  // Filter the tests based on the selected date range
  filterTestsByDate(startDate2, endDate2).then((filteredTests) => {
    // Render the filtered tests in the table
    renderFilteredTests(filteredTests);
  });
});

// Function to filter the tests based on the selected date range
function filterTestsByDate(startDate2, endDate2) {
  // Get a reference to the "patients" node in Firebase
  const patientsRef = ref(database, 'patients');

  // Fetch the patient data from Firebase
  return get(patientsRef).then((snapshot) => {
      const patientsData = snapshot.val();
      const filteredTests = [];

      // Check if patientsData exists and contains patient objects
      if (patientsData) {
        // Loop through each patient in the patientsData
        for (const patientId in patientsData) {
          const patient = patientsData[patientId];

          // Check if the patient has the "testsTaken" node
          if (patient.hasOwnProperty('testsTaken')) {
            const testsTaken = patient.testsTaken;

            // Loop through each test with unique identifiers
            for (const testId in testsTaken) {
              const testData = testsTaken[testId];
              const dateTakenValue = testData.dateTaken;

              // Check if the test date is within the selected date range
              if (dateTakenValue >= startDate2 && dateTakenValue <= endDate2) {
                // Add the test data to the filteredTests array
                filteredTests.push({
                  patientId: patientId,
                  testId: testId,
                  testsTakenValue: testData.testsTaken,
                  
                  dateTakenValue: new Date(testData.dateTaken), // Convert to Date object
                  priceValue: testData.price
                });
              }
              
            }
          }
        }
      }

      return filteredTests;

    }).catch((error) => {
      console.error('Error fetching patients data:', error);
      return [];
    });
  }
  // Function to render the filtered tests in the table
  function renderFilteredTests(filteredTests) {
    // Create a table element
    const table = document.createElement('table');
    table.classList.add('test-table');
  // Calculate total price
  let totalPrice = 0;
  filteredTests.forEach(test => {
    totalPrice += test.priceValue;
  });
// Display total price in the div
const totalPriceDiv = document.getElementById('total-price');
totalPriceDiv.innerHTML = `Total Tests Revenue: UGX  ${totalPrice}.00`;

    // Create the table header row
    const headerRow = document.createElement('tr');
    headerRow.innerHTML = `
      <th>Patient</th>
      <th>Test ID</th>
      <th>Services Offered</th>
    
      <th>Date Taken</th>
      <th>Price (UGX)</th>
    `;
    table.appendChild(headerRow);

    // Loop through each filtered test and create table rows
    filteredTests.forEach(test => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${test.patientId}</td>
        <td>${test.testId}</td>
        <td>${test.testsTakenValue}</td>
        
        <td>${test.dateTakenValue}</td>
        <td>${test.priceValue.toLocaleString('en-US', { style: 'currency', currency: 'UGX' })}</td>
      `;
      table.appendChild(row);
    });

    // Replace the existing table (if any) with the new table
    const testTableContainer = document.getElementById('test-table-container');
    testTableContainer.innerHTML = '';
    testTableContainer.appendChild(table);
  }
// Function to fetch and display the testsTaken data in a table
function fetchAndDisplayTests() {
  // Get a reference to the "patients" node in Firebase
  const patientsRef = ref(database, 'patients');

  // Fetch the patient data from Firebase
  get(patientsRef).then((snapshot) => {
    const patientsData = snapshot.val();

    // Check if patientsData exists and contains patient objects
    if (patientsData) {
      // Create a table element
      const table = document.createElement('table');
      table.classList.add('test-table');

      // Create the table header row
      const headerRow = document.createElement('tr');
      headerRow.innerHTML = `
        <th>Patient</th>
        <th>Test ID</th>
        <th>Services Offered</th>
        <th>Date Taken</th>
        <th>Price (UGX)</th>
      `;
      table.appendChild(headerRow);

      // Calculate total price while rendering the table
      let totalPrice = 0;

      // Loop through each patient in the patientsData
      for (const patientId in patientsData) {
        const patient = patientsData[patientId];

        // Check if the patient has the "testsTaken" node
        if (patient.hasOwnProperty('testsTaken')) {
          const testsTaken = patient.testsTaken;

          // Loop through each test with unique identifiers
          for (const testId in testsTaken) {
            const testData = testsTaken[testId];
            const testsTakenValue = testData.testsTaken;
            const dateTakenValue = new Date(testData.dateTaken); // Convert to Date object
            const priceValue = testData.price ;

            // Format the dateTakenValue in MM/DD/YYYY format
            const formattedDate = dateTakenValue.toLocaleDateString('en-US');

            // Create a row element for each test
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${patientId}</td>
              <td>${testId}</td>
              <td>${testsTakenValue}</td>
              <td>${formattedDate}</td>
              <td>${priceValue}</td>
            `;

            // Append the row to the table
            table.appendChild(row);

            // Add the test's price to the total price
            totalPrice += priceValue;
          }
        }
      }

      // Replace the existing table (if any) with the new table
      const testTableContainer = document.getElementById('test-table-container');
      testTableContainer.innerHTML = '';
      testTableContainer.appendChild(table);

      // Display total price in the div
      const totalPriceDiv = document.getElementById('total-price');
      totalPriceDiv.innerHTML = `Total Tests Revenue: ${totalPrice.toLocaleString('en-US', { style: 'currency', currency: 'UGX' })}`;
    } else {
      // Handle the case when there are no patients
      showMessage('No patients data found.');
    }
  }).catch((error) => {
    console.error('Error fetching patients data:', error);
  });
}

// Call the function to fetch and display the tests data
fetchAndDisplayTests();



   



displayMessage('Signing in...', 'Please wait...', false); // Pass false for error message

// Get the "Log Out" button element
const logoutButton = document.getElementById("logoutButton");

// Add event listener to the "Log Out" button
logoutButton.addEventListener("click", function(event) {
  event.preventDefault();
  logOut();

  // Trigger the sign-in popup to appear again
  var provider = new firebase.auth.GoogleAuthProvider();
  firebase.auth().signInWithPopup(provider)
    .then(function(result) {
      // Handle sign-in success
      var user = result.user;
      console.log('User signed in:', user.email);
    })
    .catch(function(error) {
      // Handle sign-in error
      console.error('Error signing in:', error);
    });
});

// Function to log out
function logOut() {
  auth.signOut()
    .then(function() {
      console.log('User signed out');
      // Refresh the page
      location.reload();
    })
    .catch(function(error) {
      console.error('Error signing out:', error);
    });
}



  const form = document.querySelector('.popup-form');
const submitButton = document.querySelector('.popup-form button');
const successMessage = document.createElement('p');
successMessage.textContent = 'Medicine details uploaded successfully!';
successMessage.style.color = 'green';
const errorMessage = document.createElement('p');
errorMessage.textContent = 'Error uploading patient details. Please try again.';
errorMessage.style.color = 'red';
const patientsContainer = document.getElementById('patients');
let patients = []; // Declare patients variable outside the event listener




function renderPatients(patients) {
 
}
  patientsContainer.innerHTML = '';


const salesContainer = document.getElementById('salesContainer');
// Add these lines at the beginning of your JavaScript file to get references to the filter elements
const startDateInput = document.getElementById('start-date');
const endDateInput = document.getElementById('end-date');
const filterButton = document.getElementById('filter-button');

// Declare the salesChart and salesTrendChart variables outside the renderSalesTable function
let salesChart;
let salesTrendChart;
// Function to render the sales table and sales trend chart
function renderSalesTable(sales) {

// Sort the sales array by date and time in descending order
sales.sort((a, b) => {
  const dateA = new Date(`${a.saleData.date} ${a.saleData.time}`);
  const dateB = new Date(`${b.saleData.date} ${b.saleData.time}`);
  return dateB - dateA;
});

// Add an event listener to the filter button
filterButton.addEventListener('click', applyDateFilter);

// Function to filter the sales data by date
function applyDateFilter() {
  const startDate = new Date(startDateInput.value);
  let endDate = new Date(endDateInput.value);

  // Adjust the end date to the end of the day
  endDate.setHours(23, 59, 59, 999);

  // Fetch the original sales data (before sorting by date)
  const originalSales = [...sales];

  // Filter the sales data based on the date range
  const filteredSales = originalSales.filter((sale) => {
    const [month, day, year] = sale.saleData.date.split('/').map(Number);
    const saleDate = new Date(year, month - 1, day, 0, 0, 0, 0); // Start of the day

    return saleDate >= startDate && saleDate <= endDate;
  });


  // Render the filtered sales table
  console.log('Filter Complete');
  renderSalesTable(filteredSales);
}


// Get a reference to the "Clear Filter" button
const clearFilterButton = document.getElementById('clear-filter-button');

function clearDateFilter() {
  startDateInput.value = ''; // Reset the start date input
  endDateInput.value = ''; // Reset the end date input

  // Render the table with the original sales data
  renderSalesTable(originalSales);
}

// Add an event listener to the "Clear Filter" button
clearFilterButton.addEventListener('click', searchByMedicine);

  // Create a table element
  const table = document.createElement('table');
  table.classList.add('sales-table');

  // Create the table header row
  const headerRow = document.createElement('tr');
  headerRow.innerHTML = `
    <th>Medicine</th>
    <th>Quantity</th>
    <th>Price (Ug.sh)</th>
    <th>Date</th>
    <th>Time</th>
    <th>Action</th>
  `;
  table.appendChild(headerRow);

  // Object to store the total incomes for each medicine
  const medicineIncomes = {};

  // Object to store the total sales for each day
  const salesByDay = {};


  // Destroy the existing salesChart if it exists
  if (salesChart) {
    salesChart.destroy();
  }

  // Destroy the existing salesTrendChart if it exists
  if (salesTrendChart) {
    salesTrendChart.destroy();
  }

  // Loop through each sale
  sales.forEach(sale => {
    const patientName = sale.patientName;
    const saleData = sale.saleData;

    // Create a row element for each sale
    const row = document.createElement('tr');

    // Create and append the patient name cell
    const patientNameCell = document.createElement('td');
    patientNameCell.textContent = patientName;
    row.appendChild(patientNameCell);

    // Create and append the sale quantity cell
    const quantityCell = document.createElement('td');
    quantityCell.textContent = saleData.quantity + ' pcs';
    row.appendChild(quantityCell);

    // Get the medicine ID from the saleData
    const medicineId = saleData.medicineId;

    // Create and append the price cell
    const priceCell = document.createElement('td');

    // Fetch the medicine data from the database
    const medicineRef = ref(database, `medicine/${patientName}`);
    get(medicineRef).then((snapshot) => {
      if (snapshot.exists()) {
        const medicineData = snapshot.val();
        const price = medicineData.price;
        priceCell.textContent = price ? price : 'N/A';

        // Calculate the total income for each medicine
        const totalIncome = price * saleData.quantity;

        // Aggregate the total income for each medicine
        if (medicineIncomes[patientName]) {
          medicineIncomes[patientName] += totalIncome;
        } else {
          medicineIncomes[patientName] = totalIncome;
        }
  // Aggregate the total sales for each day
  const day = saleData.date;
    if (salesByDay[day]) {
      salesByDay[day]++;
    } else {
      salesByDay[day] = 1;
    }
        // Update the chart and total amount
        updateChart();
        updateTotalAmount();
      } else {
        priceCell.textContent = 'N/A';
      }
    }).catch((error) => {
      console.log('Error fetching medicine data:', error);
      priceCell.textContent = 'N/A';
    });

    row.appendChild(priceCell);

    // Create and append the sale date cell
    const dateCell = document.createElement('td');
    dateCell.textContent = saleData.date;
    row.appendChild(dateCell);

    // Create and append the sale time cell
    const timeCell = document.createElement('td');
    timeCell.textContent = saleData.time;
    row.appendChild(timeCell);

// Create and append the delete button cell
const deleteCell = document.createElement('td');
const deleteButton = document.createElement('button');
deleteButton.classList.add('delete-button');
deleteButton.innerHTML = '<i class="fa fa-trash"></i>';

// Get the sale ID
const saleId = sale.saleId; // Assuming you have the sale ID available in the sale object

// Add the sale ID as a data attribute to the delete button
deleteButton.dataset.saleId = saleId;

deleteButton.addEventListener('click', function() {
  // Get the patient name and sale ID from the data attributes
  const patientName = sale.patientName;
  const saleId = this.dataset.saleId;

  // Call the deleteSale function to delete the sale from Firebase
  deleteSale(patientName, saleId)
    .then(() => {
      // Delete successful
      row.remove();

      // Update the chart and total amount after deleting a sale
      updateChart();
      updateTotalAmount();
    })
    .catch(error => {
      console.log('Error deleting sale:', error);
    });
});


deleteCell.appendChild(deleteButton);
row.appendChild(deleteCell);

let totalSalesCount = 0;
let previousDaySalesCount = 0;

// Update the sales count in the HTML
const salesCountElement = document.getElementById('salesCount');

// Iterate over the values in salesByDay and add them to the totalSalesCount
Object.values(salesByDay).forEach(count => {
  totalSalesCount += count;

  // Compare with the previous day's sales count and update arrow direction
  if (previousDaySalesCount > count) {
    // Display arrow up
    const arrowUp = '<span class="arrow-up">&#8593;</span>';
    salesCountElement.innerHTML = totalSalesCount + ' ' + arrowUp;
  } else if (previousDaySalesCount < count) {
    // Display arrow down
    const arrowDown = '<span class="arrow-down">&#8595;</span>';
    salesCountElement.innerHTML = totalSalesCount + ' ' + arrowDown;
  } else {
    // No change, display sales count without arrow
    salesCountElement.innerText = totalSalesCount.toString();
  }

  previousDaySalesCount = count;
});


// Function to delete a sale from Firebase
function deleteSale(patientName, saleId) {
  console.log('Deleting sale for patient:', patientName);
  console.log('Sale ID:', saleId);

  // Prompt the user for confirmation
  const confirmation = confirm('Are you sure you want to delete this sale?');

  if (confirmation) {
    // Prompt the user for password
    const password = prompt('Please enter your password to confirm the deletion:');

    // Check if the password is correct
    if (password === 'mm') { // Replace 'your_password' with the actual password
      // Create a reference to the specific sale in the patient's sales node
      const saleRef = ref(database, `medicine/${patientName}/sales/${saleId}`);

      // Remove the sale node from the database
      return remove(saleRef)
        .then(() => {
          alert('Sale deleted successfully!');
        })
        .catch((error) => {
          console.error('Error deleting sale:', error);
          alert('Error deleting sale. Please try again.');
        });
    } else {
      alert('Wrong password. Deletion cancelled.');
    }
  }
}




    // Aggregate the total sales for each day
    const day = saleData.date;
    if (salesByDay[day]) {
      salesByDay[day]++;
    } else {
      salesByDay[day] = 1;
    }

    // Append the row to the table
    table.appendChild(row);
    
  });

  // Clear the sales container
  salesContainer.innerHTML = '';

  // Append the table to the sales container
 // salesContainer.appendChild(table);


 // Create and update the chart
const chartCanvas = document.getElementById('salesChart');
if (chartCanvas) {
  updateChart();
}

// Create and update the sales trend chart
const trendChartCanvas = document.getElementById('salesTrendChart');
if (trendChartCanvas) {
  updateSalesTrendChart();
}

function updateChart() {
  // Destroy the existing chart if it exists
  if (salesChart) {
    salesChart.destroy();
  }

  const medicineNames = Object.keys(medicineIncomes);
  const totalIncomes = Object.values(medicineIncomes);

  // Sort the medicines based on their incomes in descending order
  const sortedMedicines = medicineNames
    .map((name, index) => ({ name, income: totalIncomes[index] }))
    .sort((a, b) => b.income - a.income);

  // Get the top 5 selling medicines
  const topSellingMedicines = sortedMedicines.slice(0, 5);

  const chartData = {
    labels: medicineNames, // Use all medicine names for the chart labels
    datasets: [
      {
        label: 'Estimated Income (UGX)',
        data: totalIncomes, // Use all medicine incomes for the chart data
        backgroundColor: 'rgba(75, 192, 192, 0.5)',
        borderColor: 'rgba(75, 192, 192, 1)',
        borderWidth: 1,
      },
    ],
  };

  const chartOptions = {
    scales: {
      y: {
        beginAtZero: true,
      },
    },
  };

  const ctx = chartCanvas.getContext('2d');
  salesChart = new Chart(ctx, {
    type: 'bar',
    data: chartData,
    options: chartOptions,
  });

// Display the top selling medicines in the topSellingTable element
const topSellingTable = document.getElementById('topsells');
topSellingTable.innerHTML = '';

// Create a table element
const table = document.createElement('table');
table.classList.add('topsell-table');

// Create the table header row
const headerRow = document.createElement('tr');
headerRow.innerHTML = `
  <th>Medicine Name</th>
  <th>Income (UGX)</th>
`;
table.appendChild(headerRow);

// Loop through each top selling medicine
topSellingMedicines.forEach((medicine) => {
  // Create a row element for each medicine
  const row = document.createElement('tr');

  // Create the cell for medicine name
  const medicineNameCell = document.createElement('td');
  medicineNameCell.textContent = medicine.name;
  row.appendChild(medicineNameCell);

  // Create the cell for medicine income
  const medicineIncomeCell = document.createElement('td');
  medicineIncomeCell.textContent = ` ${medicine.income.toLocaleString('en-US', { style: 'currency', currency: 'UGX' })}`;
  row.appendChild(medicineIncomeCell);

  // Append the row to the table
  table.appendChild(row);
});

// Append the table to the topSellingTable element
topSellingTable.appendChild(table);

}

function updateSalesTrendChart() {
  // Destroy the existing chart if it exists
  if (salesTrendChart) {
    salesTrendChart.destroy();
  }

  const days = Object.keys(salesByDay).reverse(); // Reverse the array of days
  const salesCount = Object.values(salesByDay).reverse(); // Reverse the array of sales counts

  const chartData = {
    labels: days,
    datasets: [
      {
        label: 'Sales Count by Date',
        data: salesCount,
        backgroundColor: 'rgba(255, 99, 132, 0.5)',
        borderColor: 'rgba(255, 99, 132, 1)',
        borderWidth: 1,
      },
    ],
  };

  const chartOptions = {
    scales: {
      y: {
        beginAtZero: true,
      },
    },
  };

  const ctx = trendChartCanvas.getContext('2d');
  salesTrendChart = new Chart(ctx, {
    type: 'line',
    data: chartData,
    options: chartOptions,
  });
}

function updateTotalAmount() {
  const totalAmountElement = document.getElementById('totalAmount');
  const totalAmount = Object.values(medicineIncomes).reduce((acc, curr) => acc + curr, 0);
  const formattedAmount = totalAmount.toLocaleString('en');
  totalAmountElement.innerHTML = `<i class="fa fa-money earnings-icon"></i> <span class="earnings-text"><br> UGX ${formattedAmount}.00</span>`;
}

// Call the function to update the total revenue collected
updateTotalAmount();


}





// Function to fetch all sales data
function fetchAllSalesData() {
  // Show the loader
  loaderElement.classList.remove('hidden');

  // Clear the sales container
  salesContainer.innerHTML = '';

  // Search through Firebase for patient names by key
  const patientsRef = ref(database, 'medicine');
  onValue(patientsRef, (snapshot) => {
    const patientsData = snapshot.val();
    const allSales = [];

    if (patientsData) {
      const patients = Object.values(patientsData);

      // Loop through all patients and collect sales data
      patients.forEach(patient => {
        if (patient.hasOwnProperty('sales')) {
          const salesNode = patient.sales;

          for (const saleKey in salesNode) {
            const saleData = salesNode[saleKey];
            const saleId = saleKey; // Set the saleId as the key
            allSales.push({
              patientName: patient.name,
              saleData: saleData,
              saleId: saleId, // Include the saleId property
            });
          }
        }
      });
    }

    // Pass the allSales array to the renderSalesTable function
    renderSalesTable(allSales);

    // Hide the loader
    loaderElement.classList.add('hidden');
  });
}


// Function to search sales by medicine
function searchByMedicine() {
  const medicineInput = document.getElementById('medicineInput');
  const medicineKeyword = medicineInput.value.toLowerCase();

// Function to filter patients based on the search term
function filterPatients(patients, searchTerm) {
  const filteredPatients = patients.filter((patient) => {
    const patientName = patient.name.toLowerCase();
    return patientName.includes(searchTerm.toLowerCase());
  });
  renderPatients(filteredPatients);
}

// Add event listener to search input for live search
medicineInput.addEventListener('input', () => {
  const searchTerm = medicineInput.value.trim(); // Get the search term
  const patientsRef = ref(database, 'medicine');
  onValue(patientsRef, (snapshot) => {
    const patientsData = snapshot.val();
    const patients = patientsData ? Object.values(patientsData) : [];
    filterPatients(patients, searchTerm);
  });
});
  // Show the loader
  loaderElement.classList.remove('hidden');

  // Clear the sales container
  salesContainer.innerHTML = '';

  // Search through Firebase for patient names by key
  const patientsRef = ref(database, 'medicine');
  onValue(patientsRef, (snapshot) => {
    const patientsData = snapshot.val();
    const searchResults = [];

    if (patientsData) {
      const patients = Object.values(patientsData);

      // Filter patients based on the search term
      patients.forEach(patient => {
        const medicineMatch = patient.name.toLowerCase().includes(medicineKeyword);

        // Check if the patient has sales data
        if (patient.hasOwnProperty('sales')) {
          const salesNode = patient.sales;

          // Loop through each sale in the sales node
          for (const saleKey in salesNode) {
            const saleData = salesNode[saleKey];

            if (medicineKeyword === '' || medicineMatch) {
              searchResults.push({
                patientName: patient.name,
                saleData: saleData
              });
            }
          }
        }
      });
    }

    // Hide the loader
    loaderElement.classList.add('hidden');

    // Display search results
    if (searchResults.length > 0) {
      renderSalesTable(searchResults);
    } else {
      salesContainer.innerHTML = '<p class="no-results">Oops... No sales found.</p>';
    }
  });
}

// Get a reference to the medicine input element
const medicineInput = document.getElementById('medicineInput');

// Add event listener to medicine input for live search
medicineInput.addEventListener('input', searchByMedicine);
// Add event listener to search medicine button
const searchMedicineButton = document.getElementById('searchMedicineButton');
searchMedicineButton.addEventListener('click', searchByMedicine);

// Fetch all sales data on page load
window.addEventListener('load', fetchAllSalesData);


const loaderElement = document.getElementById('loader');

// Retrieve and render patients
const patientsRef = ref(database, 'medicine');

// Show the loader
loaderElement.classList.remove('hidden');

// Fetch patient data from Firebase
onValue(patientsRef, (snapshot) => {
  patientsData = snapshot.val() ? Object.values(snapshot.val()).reverse() : [];
  // Update the pagination and render the patients
  renderPatients();
  loaderElement.classList.add('hidden');

});
// Get the online status element
const onlineStatusElement = document.getElementById('onlineStatus');
const overlayElement = document.getElementById('overlay');

// Function to update the online status indicator
function updateOnlineStatus() {
  if (navigator.onLine) {
    onlineStatusElement.innerHTML = '<i class="fa fa-wifi"></i>Online';
    onlineStatusElement.classList.remove('offline');
    onlineStatusElement.classList.add('online');
    overlayElement.style.display = 'none';
  } else {
    onlineStatusElement.innerHTML = '<i class="fa fa-exclamation-triangle"></i>Offline';
    onlineStatusElement.classList.remove('online');
    onlineStatusElement.classList.add('offline');
    overlayElement.style.display = 'block';
  }
}


// Initial update of online status
updateOnlineStatus();

// Add event listeners for online and offline events
window.addEventListener('online', updateOnlineStatus);
window.addEventListener('offline', updateOnlineStatus);


function getGreeting() {
  var currentDate = new Date();
  var currentHour = currentDate.getHours();

  var greeting;
  if (currentHour < 12) {
    greeting = "Good morning";
  } else if (currentHour < 18) {
    greeting = "Good afternoon";
  } else {
    greeting = "Good evening";
  }

  return greeting;
}

var greetingDiv = document.getElementById("greeting");
var greeting = getGreeting();
greetingDiv.textContent = greeting;


 // Hide the splash screen after the website content is loaded
 window.addEventListener('load', function () {
      const splashScreen = document.getElementById('splashScreen');
      splashScreen.style.opacity = '0';
      setTimeout(function () {
        splashScreen.style.display = 'none';
      }, 5000); // Change this duration to control how long the splash screen is shown (in milliseconds)
    });
</script>


  </body>
<!-- partial -->
  <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js'></script><script  src="./portal.js"></script>

</body>
</html>
